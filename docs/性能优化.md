# 性能优化

我们在 ByteOS 中实现了许多对于内核性能的优化措施，比如 `COW(Copy On Write)`, `内存延迟分配`, `文件缓存`, `文件树` 等。

我们为 `UserTask` 提供了一个 `cow_fork` 接口，当我们需要 `fork` 一个程序的时候我们可以使用这个接口进行复制。然后在内存触发页中断的时候进行复制。

我们在 `mmap` 的时候先给程序分配一些空间，但是并不分配内存给他，在触发页中断之后我们会根据触发中断的地址进行判断，如果是已经分配的内存，那么将会申请内存给这个程序，将空间进行映射。

我们发现有些程序频繁被执行，但是执行时间比较短，所以我们采用 `文件缓冲` 的方式进行处理，后来我们衍生出了 "进程模板"，即采用一个结构存储程序执行需要的页表等结构，在执行时使用类似 `cow_fork` 的机制分配给他，减少了频繁执行某些程序的页表释放操作，那么性能将大大提升。

为了提高我们 OS 的文件检索性能，我们构建了 `DentryTree` 的结构。在检索文件时，现在 `DentryTree` 上检索文件的存在，如果文件存在，那么直接进行复制。对于频繁的文件检索和操作性能将大大提升。如 `Stat`, `StatFS`。